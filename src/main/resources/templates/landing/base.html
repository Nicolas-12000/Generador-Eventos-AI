<!DOCTYPE html>
<html xmlns:th="http://www.thymeleaf.org">
<head>
  <meta charset="UTF-8">
  <title th:text="${vm.landing.customTitle}">Event Landing</title>
  <!-- CSS principal con variables de paleta -->
  <style>
    :root {
      /* Paleta de colores */
      --color-primary:   #1a73e8;
      --color-secondary: #e37400;
      --color-bg-light:  #f5f7fa;
      --color-text-dark: #202124;
      --color-white:     #ffffff;
      --color-gray:      #5f6368;
    }
    body {
      margin: 0; padding: 0;
      font-family: 'Montserrat', sans-serif;
      background-color: var(--color-bg-light);
      color: var(--color-text-dark);
    }
    header {
      background-color: var(--color-primary);
      color: var(--color-white);
      padding: 3rem 1rem;
      text-align: center;
    }
    header h1 { margin: 0; font-size: 2.5rem; }
    header p { margin: 0.5rem 0 1.5rem; font-size: 1.2rem; color: var(--color-white); }
    .intro { font-size: 1rem; max-width: 600px; margin: 0 auto; color: var(--color-white); }
    section {
      background: var(--color-white);
      margin: 2rem auto; padding: 2rem;
      max-width: 900px; border-radius: 8px;
      box-shadow: 0 4px 8px rgba(0,0,0,0.05);
    }
    h2 {
      margin-top: 0; color: var(--color-secondary);
      font-size: 1.8rem;
      border-bottom: 2px solid var(--color-secondary);
      padding-bottom: 0.5rem;
    }
    table { width: 100%; border-collapse: collapse; margin-top: 1rem; }
    th, td {
      padding: 0.75rem; text-align: left;
      border-bottom: 1px solid #e0e0e0;
    }
    th { background-color: var(--color-primary); color: var(--color-white); }
    .speakers-list {
      display: grid; grid-template-columns: repeat(auto-fit, minmax(250px, 1fr));
      gap: 1.5rem; margin-top: 1rem;
    }
    .speaker-card {
      background: var(--color-bg-light); padding: 1rem;
      border-radius: 6px; box-shadow: 0 2px 4px rgba(0,0,0,0.05);
    }
    .speaker-card h3 { margin: 0 0 0.5rem; font-size: 1.2rem; color: var(--color-primary); }
    .speaker-card p { margin: 0; color: var(--color-gray); }
    footer { text-align: center; padding: 1rem; font-size: 0.9rem; color: var(--color-gray); }
  </style>
</head>
<body>
  <header>
    <h1 th:text="${vm.event.name}">Tech Summit 2025</h1>
    <p th:text="${vm.landing.welcomeMessage}">Join us for a day of innovation!</p>
    <p class="intro">
      Explore inspiring sessions on AI, Cloud, and DevOps led by industry experts.
    </p>
  </header>

  <!-- Map Section -->
  <section th:if="${vm.landing.showMap}" id="map-section">
    <h2>Location</h2>
    <div id="map" style="height: 350px; width: 100%;"></div>
    <!-- Si no hay coordenadas, geocode a partir de la direcciÃ³n -->
  </section>

  <!-- Schedule Section -->
  <section th:if="${vm.landing.showSchedule}" id="schedule-section">
    <h2>Event Schedule</h2>
    <table id="schedule-table">
      <thead>
        <tr><th>Start</th><th>End</th><th>Session</th></tr>
      </thead>
      <tbody></tbody>
    </table>
  </section>

  <!-- Speakers Section -->
  <section th:if="${vm.landing.showSpeakers}" id="speakers-section">
    <h2>Speakers</h2>
    <div class="speakers-list" id="speakers-list"></div>
  </section>

  <footer>
    <p>&copy; 2025 TuEvento. All rights reserved.</p>
  </footer>

  <!-- Injection of VM for JS -->
  <script th:inline="javascript">
    /*<![CDATA[*/
    window.vm = /*[[${vm}]]*/ {};
    /*]]>*/
  </script>

  <!-- Google Maps API -->
  <script async defer
    th:src="@{https://maps.googleapis.com/maps/api/js(key=${vm.googleMapsApiKey},libraries=places,callback='initMap')}">
  </script>

  <!-- Main JS -->
  <script th:inline="javascript">
    /*<![CDATA[*/
    class Section { constructor(id, vm){ this.el=document.getElementById(id); this.vm=vm;} init(){} }

    class MapSection extends Section {
      init() {
        const hasCoords = this.vm && this.vm.landing;
        const lat = hasCoords ? this.vm.landing.latitude : null;
        const lng = hasCoords ? this.vm.landing.longitude : null;
        const addr = hasCoords ? this.vm.landing.locationAddress : null;
        if (!this.el) return;
        const mapInit = ({lat,lng}) => {
          const map = new google.maps.Map(this.el, {center:{lat,lng}, zoom:13});
          new google.maps.Marker({position:{lat,lng}, map});
          if (addr) new google.maps.InfoWindow({content:`<p>${addr}</p>`}).open(map);
        };
        if (lat != null && lng != null) {
          mapInit({lat,lng});
        } else if (addr) {
          const geocoder = new google.maps.Geocoder();
          geocoder.geocode({address: addr}, (results, status) => {
            if (status === 'OK' && results[0]) {
              const loc = results[0].geometry.location;
              mapInit({lat: loc.lat(), lng: loc.lng()});
            }
          });
        }
      }
    }

    class ScheduleSection extends Section {
      init() {
        if (!this.el || !this.vm || !this.vm.landing || !this.vm.landing.schedule) return;
        const tbody = this.el.querySelector('tbody');
        this.vm.landing.schedule.forEach(item=>{
          const row = document.createElement('tr');
          row.innerHTML = `<td>${item.startTime}</td><td>${item.endTime}</td><td>${item.description}</td>`;
          tbody.appendChild(row);
        });
      }
    }

    class SpeakersSection extends Section {
      init() {
        if (!this.el || !this.vm || !this.vm.landing || !this.vm.landing.speakers) return;
        this.vm.landing.speakers.forEach(s=>{
          const card = document.createElement('div');
          card.className = 'speaker-card';
          card.innerHTML = `<h3>${s.name}</h3><p>${s.description}</p>`;
          this.el.appendChild(card);
        });
      }
    }

    document.addEventListener('DOMContentLoaded',()=>{
      new MapSection('map',window.vm).init();
      new ScheduleSection('schedule-table',window.vm).init();
      new SpeakersSection('speakers-list',window.vm).init();
    });

    function initMap() { new MapSection('map', window.vm).init(); }
    /*]]>*/
  </script>
</body>
</html>
